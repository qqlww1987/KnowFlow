<div align="center">
  <img src="assets/logo.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“" width="30%">
</div>

## é¡¹ç›®ä»‹ç»

KnowFlow æ˜¯ä¸€ä¸ªåŸºäº RAGFlow çš„å¼€æºé¡¹ç›®ï¼ŒæŒç»­å…¼å®¹ RAGFlow å®˜æ–¹ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¼šå°†ç¤¾åŒºé‡Œåšçš„æ¯”è¾ƒå¥½çš„æœ€ä½³å®è·µæ•´åˆè¿›æ¥ã€‚
KnowFlow å¯ä»¥ç†è§£æˆ RAGFlow å®˜æ–¹å¼€æºäº§å“çœŸæ­£è½åœ°ä¼ä¸šåœºæ™¯çš„æœ€åä¸€å…¬é‡ŒæœåŠ¡ã€‚

## åŠŸèƒ½ä»‹ç»

### é€‚é… RAGFlow å…¨æ–° UI

åŸºäº RAGFlow v0.18.0 äºŒæ¬¡å¼€å‘å…¨æ–° UI é¡µé¢ã€‚

<div align="center">
  <img src="assets/ui_1.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“">
</div>

<div align="center">
  <img src="assets/ui_2.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“">
</div>

### ç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿ

å‚è€ƒ [ragflow-plus](https://github.com/zstar1003/ragflow-plus/)

<div align="center">
  <img src="assets/user-setting.png"  alt="ç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿ">
</div>

ç§»é™¤åŸç™»é™†é¡µç”¨æˆ·æ³¨å†Œçš„é€šé“ï¼Œæ­å»ºç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿï¼Œå¯å¯¹ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€å›¢é˜Ÿç®¡ç†ã€ç”¨æˆ·æ¨¡å‹é…ç½®ç®¡ç†ç­‰åŠŸèƒ½ã€‚

ç‰¹ç‚¹ï¼šæ–°å»ºç”¨æˆ·æ—¶ï¼Œæ–°ç”¨æˆ·ä¼šè‡ªåŠ¨åŠ å…¥åˆ›å»ºæ—¶é—´æœ€æ—©ç”¨æˆ·çš„å›¢é˜Ÿï¼Œå¹¶é»˜è®¤é‡‡å–å’Œæœ€æ—©ç”¨æˆ·ç›¸åŒçš„æ¨¡å‹é…ç½®ã€‚

### å›¾æ–‡æ··æ’è¾“å‡º

1. æ”¯æŒå¸‚é¢ä¸Šå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼Œå¦‚ ppt/png/word/doc/excel/...ç­‰ç­‰
2. ä¿æŒå’Œå®˜æ–¹ markdown **å®Œå…¨ä¸€è‡´**çš„åˆ†å—è§„åˆ™ï¼Œå…±æä¾›äº†ä¸‰ç§åˆ†å—ç­–ç•¥ï¼Œä¿è¯åˆ†å—å’Œå‘é‡åŒ–æ£€ç´¢æ•ˆæœï¼Œä¸”å…·å¤‡å¼€æ”¾æ€§ï¼Œåç»­å¯æŒç»­å¢å¼º
3. æ— ç¼å¯¹æ¥ RAGFlow çŸ¥è¯†åº“ç³»ç»Ÿï¼Œæ–‡æ¡£è‡ªåŠ¨è§£æå’Œåˆ†å—

<div align="center">
  <img src="assets/mulcontent.png"  alt="å›¾æ–‡æ··æ’">
</div>

### æ”¯æŒä¼ä¸šå¾®ä¿¡åº”ç”¨

æ”¯æŒä¼ä¸šå¾®ä¿¡åº”ç”¨ï¼Œå¯å°†ä¼ä¸šå¾®ä¿¡åº”ç”¨ä½œä¸ºèŠå¤©æœºå™¨äººï¼Œä½¿ç”¨ä¼ä¸šå¾®ä¿¡åº”ç”¨è¿›è¡ŒèŠå¤©ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼å‚ç…§  `server/services/knowflow/README.md` ä¸­çš„è¯´æ˜ã€‚

<div align="center">
  <img src="assets/wecom.jpg" style="height: 400px;" alt="ä¼ä¸šå¾®ä¿¡åº”ç”¨">
</div>

## ä½¿ç”¨æ–¹å¼

### 0. MinerU æœ¬åœ°è°ƒè¯•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

å¦‚æœæ‚¨éœ€è¦åœ¨æœ¬åœ°ç¯å¢ƒè¿›è¡Œå¼€å‘è°ƒè¯•ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ MinerU æœåŠ¡ï¼š

```bash
# 1. å®‰è£… Python ä¾èµ–ï¼ˆæ³¨æ„ï¼šzsh éœ€è¦ç”¨å¼•å·åŒ…å›´æ–¹æ‹¬å·ï¼‰
pip install "mineru[core]" fastapi uvicorn python-multipart

# 2. è®¾ç½®ç¯å¢ƒå˜é‡
export MINERU_DEVICE_MODE=cpu
export MINERU_MODEL_SOURCE=modelscope

# 3. è¿›å…¥é¡¹ç›®ç›®å½•
cd web_api

# 4. å¯åŠ¨æœ¬åœ°æœåŠ¡
python app.py
```

**é…ç½® settings.yamlï¼š**

ä½¿ç”¨æœ¬åœ° MinerU æœåŠ¡æ—¶ï¼Œéœ€è¦ä¿®æ”¹ `server/services/config/settings.yaml` ä¸­çš„æœåŠ¡åœ°å€ï¼š

```yaml
mineru:
  fastapi:
    # æœ¬åœ°å¼€å‘æœåŠ¡åœ°å€
    url: "http://localhost:8888"
  
  vlm:
    sglang:
      # æœ¬åœ°SGLangæœåŠ¡åœ°å€ï¼ˆå¦‚æœä½¿ç”¨vlm-sglang-clientåç«¯ï¼‰
      server_url: "http://localhost:30000"
```

> ğŸ’¡ **æç¤ºï¼š** æœ¬åœ°è°ƒè¯•æ¨¡å¼é€‚åˆå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Dockeræ–¹å¼éƒ¨ç½²

### 1. ä½¿ç”¨ Docker Compose è¿è¡Œ

1. å¯åŠ¨ MinerU æœåŠ¡

   é€‰æ‹©ä»¥ä¸‹ä¸¤ç§é•œåƒä¹‹ä¸€ï¼š

   **å®Œæ•´ç‰ˆï¼ˆæ¨èï¼‰- åŒ…å«æ‰€æœ‰åŠŸèƒ½**
   ```bash
   docker run --rm -d --gpus=all \
     --shm-size=32g \
     -p 8888:8888 -p 30000:30000 \
     --name mineru-api \
     zxwei/mineru-api-full
   ```

   **åŸºç¡€ç‰ˆ - ä»…åŒ…å«åŸºç¡€åŠŸèƒ½**
   ```bash
   docker run --rm -d --gpus=all \
     --shm-size=32g \
     -p 8888:8888 \
     --name mineru-api \
     zxwei/mineru-api
   ```

   > ğŸ’¡ **é•œåƒè¯´æ˜ï¼š**
   > - `zxwei/mineru-api-full`ï¼šåŒ…å«å®Œæ•´çš„ VLM åŠŸèƒ½ï¼Œæ”¯æŒæ‰€æœ‰åç«¯ç±»å‹
   > - `zxwei/mineru-api`ï¼šåŸºç¡€ç‰ˆæœ¬ï¼Œä¸»è¦æ”¯æŒ pipeline åç«¯
   > - `server/services/config/settings.yaml` å¯ä»¥é…ç½®é€‰æ‹© MinerU æ¨¡å¼
   > - å¦‚éœ€ GPU åŠ é€Ÿï¼Œè¯·ç¡®ä¿å·²å®‰è£… nvidia-container-toolkit


2. æ‰§è¡Œå®‰è£…è„šæœ¬ï¼Œè‡ªåŠ¨ç”Ÿæˆé…ç½®

   ```bash
   ./scripts/install.sh
   ```

   > ğŸ’¡ **è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼š**
   > - è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹æœ¬æœºIPåœ°å€
   > - è‡ªåŠ¨åˆ›å»º `.env` é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
   > - å¦‚æœ `.env` æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæä¾›é€‰é¡¹ï¼šä¿ç•™ç°æœ‰é…ç½®æˆ–é‡æ–°ç”Ÿæˆ

3. å®Œå–„ `.env` æ–‡ä»¶é…ç½®

   å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º `.env` æ–‡ä»¶æ¨¡æ¿ï¼Œæ‚¨åªéœ€è¦å¡«å†™ä¸¤ä¸ªå¿…è¦ä¿¡æ¯ï¼š

   ```bash
   # ä» RAGFlow API é¡µé¢åå°è·å– (å¿…é¡»æ‰‹åŠ¨å¡«å†™)
   RAGFLOW_API_KEY=ä½ çš„å®é™…APIå¯†é’¥

   # ç¡®è®¤ç«¯å£å·å¹¶æ›¿æ¢ (é€šå¸¸RAGFlowé»˜è®¤ç«¯å£æ˜¯80æˆ–8080)
   RAGFLOW_BASE_URL=http://æ£€æµ‹åˆ°çš„IP:å®é™…ç«¯å£å·
   ```

   > ğŸ’¡ **æç¤ºï¼š** å…¶ä»–é…ç½®é¡¹ï¼ˆå¦‚HOST_IPã€ES_HOSTç­‰ï¼‰å·²ç”±è„šæœ¬è‡ªåŠ¨å¡«å†™

4. å¯åŠ¨å®¹å™¨ï¼Œå¼€å§‹æ„‰å¿«ä¹‹æ—…

   ```bash
   docker compose up -d
   ```

   è®¿é—®åœ°å€ï¼š`æœåŠ¡å™¨ip:8888`ï¼Œè¿›å…¥åˆ°ç®¡ç†ç•Œé¢

### 2. æºç è¿è¡Œ

å‚ç…§ Docker Compose ä½¿ç”¨æ–¹å¼çš„å‰é¢æ­¥éª¤ï¼Œç¡®ä¿ MinerU æœåŠ¡å·²å¯åŠ¨ã€‚

**å¯åŠ¨åç«¯ï¼š**

1. æ‰“å¼€åç«¯ç¨‹åº `management/server`ï¼Œå®‰è£…ä¾èµ–

   ```bash
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

2. å¼€å¯æ–‡ä»¶æ ¼å¼è½¬åŒ–æœåŠ¡ï¼ˆå¯é€‰ï¼Œæ”¯æŒ PDF ä»¥å¤–æ–‡ä»¶æ ¼å¼éœ€è¦å¼€å¯ï¼‰

   ```bash
   docker run -d -p 3000:3000 gotenberg/gotenberg:8
   ```

3. å¯åŠ¨åç«¯

   ```bash
   python3 app.py
   ```

**å¯åŠ¨å‰ç«¯ï¼š**

1. æ‰“å¼€å‰ç«¯ç¨‹åº `management\web`ï¼Œå®‰è£…ä¾èµ–

   ```bash
   pnpm i
   ```

2. å¯åŠ¨å‰ç«¯ç¨‹åº

   ```bash
   pnpm dev
   ```

æµè§ˆå™¨è®¿é—®å¯åŠ¨åçš„åœ°å€ï¼Œå³å¯è¿›å…¥ç³»ç»Ÿã€‚

> ğŸ’¡ **æç¤ºï¼š** **å›¾æ–‡æ··æ’åŠŸèƒ½**ï¼ŒèŠå¤©åŠ©æ‰‹çš„æç¤ºè¯å¾ˆé‡è¦ï¼Œé…ç½®ä¸æ­£ç¡®ä¼šæ— æ³•æ˜¾ç¤ºå›¾ç‰‡ã€‚æ¨¡æ¿å¦‚ä¸‹ï¼š<br>

> è¯·å‚è€ƒ{knowledge}å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚<br>
> å¦‚æœçŸ¥è¯†åº“å†…å®¹åŒ…å«å›¾ç‰‡ï¼Œè¯·åœ¨å›ç­”ä¸­åŒ…å«å›¾ç‰‡URLã€‚<br>
> æ³¨æ„è¿™ä¸ª html æ ¼å¼çš„ URL æ˜¯æ¥è‡ªçŸ¥è¯†åº“æœ¬èº«ï¼ŒURL ä¸èƒ½åšä»»ä½•æ”¹åŠ¨ã€‚<br>
> è¯·ç¡®ä¿å›ç­”ç®€æ´ã€ä¸“ä¸šï¼Œå°†å›¾ç‰‡è‡ªç„¶åœ°èå…¥å›ç­”å†…å®¹ä¸­ã€‚

---

### RAGFlow UIï¼ˆæ—  RAGFlow UI æ›´æ–°éœ€è¦å¯å¿½ç•¥ï¼‰

å°†å¼€æºçš„ `dist` ç›®å½•å¤åˆ¶åˆ° docker å†…çš„ /ragflow/web/dist ç›®å½•ä¸‹ï¼Œè¦†ç›–åŸæœ‰çš„ dist å³å¯

```bash
docker cp -r dist {ragflow_container_name}:/ragflow/web/
```

## ç¼–è¯‘ Dockerï¼ˆæ— ç¼–è¯‘éœ€è¦å¯å¿½ç•¥ï¼‰

```bash
docker buildx build --platform linux/amd64 --target backend -t zxwei/knowflow-server:v0.3.0 --push .

docker buildx build --platform linux/amd64 --target frontend -t zxwei/knowflow-web:v0.3.0 --push .
```

## TODO

- [x] æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼çš„ MinerU è§£æ
- [x] å¢å¼º MarkDown æ–‡ä»¶çš„åˆ†å—è§„åˆ™
- [x] ä¼˜åŒ– Excel æ–‡ä»¶åˆ†å—
- [ ] MinerU 2.0 æ¥å…¥
- [ ] RAGFlow å‰ç«¯ UI æºç å¼€æº


## äº¤æµç¾¤

å¦‚æœæœ‰å…¶å®ƒéœ€æ±‚æˆ–é—®é¢˜å»ºè®®ï¼Œå¯åŠ å…¥äº¤æµç¾¤è¿›è¡Œè®¨è®ºã€‚

å¦‚éœ€åŠ ç¾¤ï¼ŒåŠ æˆ‘å¾®ä¿¡ skycode007ï¼Œå¤‡æ³¨"åŠ ç¾¤"å³å¯ã€‚

## é¸£è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®å¼€å‘ï¼š

- [ragflow](https://github.com/infiniflow/ragflow)
- [v3-admin-vite](https://github.com/un-pany/v3-admin-vite)
- [ragflow-plus](https://github.com/zstar1003/ragflow-plus/)

## æ›´æ–°ä¿¡æ¯è·å–

ç›®å‰è¯¥é¡¹ç›®ä»åœ¨æŒç»­æ›´æ–°ä¸­ï¼Œæ›´æ–°æ—¥å¿—ä¼šåœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·[KnowFlow ä¼ä¸šçŸ¥è¯†åº“]ä¸Šå‘å¸ƒï¼Œæ¬¢è¿å…³æ³¨ã€‚

## å¸¸è§é—®é¢˜

### 1. å¦‚ä½•é€‰æ‹© MinerU é•œåƒç‰ˆæœ¬

**zxwei/mineru-api-fullï¼ˆæ¨èï¼‰ï¼š**
- åŒ…å«å®Œæ•´çš„ VLM åŠŸèƒ½
- æ”¯æŒæ‰€æœ‰åç«¯ç±»å‹ï¼špipeline, vlm-transformers, vlm-sglang-engine, vlm-sglang-client
- é•œåƒè¾ƒå¤§ï¼Œä½†åŠŸèƒ½æœ€å…¨

**zxwei/mineru-apiï¼š**
- åŸºç¡€ç‰ˆæœ¬ï¼Œé•œåƒè¾ƒå°
- ä¸»è¦æ”¯æŒ pipeline åç«¯
- é€‚åˆåŸºç¡€æ–‡æ¡£è§£æéœ€æ±‚

### 2. å¦‚ä½•ç»™ MinerU è¿›è¡Œ GPU åŠ é€Ÿ

1ï¼‰å®‰è£… nvidia-container-toolkit

```bash
# æ·»åŠ æº
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/libnvidia-container/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
  sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

# å®‰è£…ç»„ä»¶
sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit

# é‡å¯ Docker
sudo systemctl restart docker
```

2ï¼‰å¯åŠ¨ MinerU å®¹å™¨æ—¶ç¡®ä¿åŒ…å« `--gpus=all` å‚æ•°ï¼ˆå¦‚ä¸Šé¢çš„ç¤ºä¾‹å‘½ä»¤ï¼‰

3ï¼‰åœ¨ settings.yaml ä¸­é…ç½®ä½¿ç”¨ GPU åç«¯ï¼š

```yaml
mineru:
  default_backend: "vlm-sglang-client"  # ä½¿ç”¨ VLM åç«¯
```

### 3. å®¹å™¨ç½‘ç»œé…ç½®

å¦‚æœ KnowFlow server ä¹Ÿè¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œéœ€è¦æ­£ç¡®é…ç½®ç½‘ç»œåœ°å€ï¼š

- **Docker Desktop**ï¼šä½¿ç”¨ `http://host.docker.internal:8888`
- **Linux Docker**ï¼šä½¿ç”¨å®¿ä¸»æœºIPï¼Œå¦‚ `http://192.168.1.100:8888`
- **Docker Compose**ï¼šä½¿ç”¨æœåŠ¡åï¼Œå¦‚ `http://mineru-api:8888`

è¯¦ç»†é…ç½®å‚è€ƒ `DOCKER_NETWORK_GUIDE.md`

### 4. å¸¸è§é”™è¯¯å¤„ç†

1ï¼‰**ç«¯å£å†²çª**ï¼šç¡®ä¿ç«¯å£ 8888 å’Œ 30000 æœªè¢«å ç”¨

2ï¼‰**å†…å­˜ä¸è¶³**ï¼šå¢åŠ  Docker å†…å­˜é™åˆ¶æˆ–è°ƒæ•´ `--shm-size` å‚æ•°

3ï¼‰**GPU ä¸å¯ç”¨**ï¼šæ£€æŸ¥ nvidia-container-toolkit å®‰è£…å’Œ GPU é©±åŠ¨

4ï¼‰**ç½‘ç»œè¿æ¥é—®é¢˜**ï¼šæ£€æŸ¥é˜²ç«å¢™è®¾ç½®å’Œå®¹å™¨ç½‘ç»œé…ç½®





