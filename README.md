<div align="center">
  <img src="assets/logo.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“" width="30%">
</div>

## é¡¹ç›®ä»‹ç»

KnowFlow æ˜¯ä¸€ä¸ªåŸºäº RAGFlow çš„å¼€æºé¡¹ç›®ï¼ŒæŒç»­å…¼å®¹ RAGFlow å®˜æ–¹ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¼šå°†ç¤¾åŒºé‡Œåšçš„æ¯”è¾ƒå¥½çš„æœ€ä½³å®è·µæ•´åˆè¿›æ¥ã€‚
KnowFlow å¯ä»¥ç†è§£æˆ RAGFlow å®˜æ–¹å¼€æºäº§å“çœŸæ­£è½åœ°ä¼ä¸šåœºæ™¯çš„æœ€åä¸€å…¬é‡ŒæœåŠ¡ã€‚

## åŠŸèƒ½ä»‹ç»

### é€‚é… RAGFlow å…¨æ–° UI 

åŸºäº RAGFlow v0.18.0 äºŒæ¬¡å¼€å‘å…¨æ–° UI é¡µé¢ã€‚

<div align="center">
  <img src="assets/ui_1.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“">
</div>

<div align="center">
  <img src="assets/ui_2.png" alt="KnowFlow ä¼ä¸šçŸ¥è¯†åº“">
</div>


### ç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿ 

å‚è€ƒ [ragflow-plus](https://github.com/zstar1003/ragflow-plus/)

<div align="center">
  <img src="assets/user-setting.png"  alt="ç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿ">
</div>

ç§»é™¤åŸç™»é™†é¡µç”¨æˆ·æ³¨å†Œçš„é€šé“ï¼Œæ­å»ºç”¨æˆ·åå°ç®¡ç†ç³»ç»Ÿï¼Œå¯å¯¹ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€å›¢é˜Ÿç®¡ç†ã€ç”¨æˆ·æ¨¡å‹é…ç½®ç®¡ç†ç­‰åŠŸèƒ½ã€‚

ç‰¹ç‚¹ï¼šæ–°å»ºç”¨æˆ·æ—¶ï¼Œæ–°ç”¨æˆ·ä¼šè‡ªåŠ¨åŠ å…¥åˆ›å»ºæ—¶é—´æœ€æ—©ç”¨æˆ·çš„å›¢é˜Ÿï¼Œå¹¶é»˜è®¤é‡‡å–å’Œæœ€æ—©ç”¨æˆ·ç›¸åŒçš„æ¨¡å‹é…ç½®ã€‚

### å›¾æ–‡æ··æ’è¾“å‡º 

1. æ”¯æŒå¸‚é¢ä¸Šå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼Œå¦‚ ppt/png/word/doc/excel/...ç­‰ç­‰
2. ä¿æŒå’Œå®˜æ–¹ markdown **å®Œå…¨ä¸€è‡´**çš„åˆ†å—è§„åˆ™ï¼Œä¿è¯åˆ†å—å’Œå‘é‡åŒ–æ£€ç´¢æ•ˆæœï¼Œä¸”å…·å¤‡å¼€æ”¾æ€§ï¼Œåç»­å¯æŒç»­å¢å¼º
3. æ— ç¼å¯¹æ¥ RAGFlow çŸ¥è¯†åº“ç³»ç»Ÿï¼Œæ–‡æ¡£è‡ªåŠ¨è§£æå’Œåˆ†å—

<div align="center">
  <img src="assets/mulcontent.png"  alt="å›¾æ–‡æ··æ’">
</div>


### æ”¯æŒä¼ä¸šå¾®ä¿¡åº”ç”¨ 

æ”¯æŒä¼ä¸šå¾®ä¿¡åº”ç”¨ï¼Œå¯å°†ä¼ä¸šå¾®ä¿¡åº”ç”¨ä½œä¸ºèŠå¤©æœºå™¨äººï¼Œä½¿ç”¨ä¼ä¸šå¾®ä¿¡åº”ç”¨è¿›è¡ŒèŠå¤©ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼å‚ç…§  `server/services/knowflow/README.md` ä¸­çš„è¯´æ˜ã€‚

<div align="center">
  <img src="assets/wecom.jpg" style="height: 400px;" alt="ä¼ä¸šå¾®ä¿¡åº”ç”¨">
</div>


## ä½¿ç”¨æ–¹å¼

### 1. ä½¿ç”¨Docker Composeè¿è¡Œ

1. åœ¨å®¿ä¸»æœºå™¨ä¸Šä¸‹è½½ MinerU æ¨¡å‹æ–‡ä»¶

```bash
pip install modelscope
wget https://gcore.jsdelivr.net/gh/opendatalab/MinerU@master/scripts/download_models.py -O download_models.py
python3 download_models.py
```
2. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º `.env` æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹

```bash
#  ä» RAGFlow API é¡µé¢åå°è·å– (å¿…é¡»)
RAGFLOW_API_KEY=
# æ³¨æ„ä¸æ”¯æŒ 127.0.0.1ã€localhostï¼Œéœ€è¦æŠŠ 127.0.0.1 æˆ– localhost æ›¿æ¢æˆéƒ¨ç½²æœºå™¨çš„ IP åœ°å€ï¼ˆï¼‰
RAGFLOW_BASE_URL=
```

3. æ‰§è¡Œå®‰è£…è„šæœ¬ï¼Œåœ¨ .env é‡Œè¿½åŠ ç¯å¢ƒå˜é‡

```bash
./scripts/install.sh
```

4. å¯åŠ¨å®¹å™¨ï¼Œå¼€å§‹æ„‰å¿«ä¹‹æ—…
```bash
docker compose up -d
```
è®¿é—®åœ°å€ï¼š`æœåŠ¡å™¨ip:8888`ï¼Œè¿›å…¥åˆ°ç®¡ç†ç•Œé¢


### 2. æºç è¿è¡Œ

å‚ç…§ Docker Compose ä½¿ç”¨æ–¹å¼çš„å‰é¢ 1ã€2ã€3 æ­¥éª¤ï¼Œè¿™æ˜¯å‰æã€‚


å¯åŠ¨åç«¯ï¼š

1.æ‰“å¼€åç«¯ç¨‹åº`management/server`ï¼Œå®‰è£…ä¾èµ–

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```


2.å¼€å¯æ–‡ä»¶æ ¼å¼è½¬åŒ–æœåŠ¡ï¼ˆå¯é€‰ï¼Œæ”¯æŒ PDF ä»¥å¤–æ–‡ä»¶æ ¼å¼éœ€è¦å¼€å¯ï¼‰

```bash
docker run -d -p 3000:3000 gotenberg/gotenberg:8
```

3.å¯åŠ¨åç«¯

```bash
python3 app.py
```


å¯åŠ¨å‰ç«¯ï¼š

1.æ‰“å¼€å‰ç«¯ç¨‹åº`management\web`ï¼Œå®‰è£…ä¾èµ–
```bash
pnpm i
```

2.å¯åŠ¨å‰ç«¯ç¨‹åº
```bash
pnpm dev
```

æµè§ˆå™¨è®¿é—®å¯åŠ¨åçš„åœ°å€ï¼Œå³å¯è¿›å…¥ç³»ç»Ÿã€‚


> ğŸ’¡ **æç¤ºï¼š** **å›¾æ–‡æ··æ’åŠŸèƒ½**ï¼ŒèŠå¤©åŠ©æ‰‹çš„æç¤ºè¯å¾ˆé‡è¦ï¼Œé…ç½®ä¸æ­£ç¡®ä¼šæ— æ³•æ˜¾ç¤ºå›¾ç‰‡ã€‚æ¨¡æ¿å¦‚ä¸‹ï¼š<br>
> è¯·å‚è€ƒ{knowledge}å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚<br>
> å¦‚æœçŸ¥è¯†åº“å†…å®¹åŒ…å«å›¾ç‰‡ï¼Œè¯·åœ¨å›ç­”ä¸­åŒ…å«å›¾ç‰‡URLã€‚<br>
> æ³¨æ„è¿™ä¸ª html æ ¼å¼çš„ URL æ˜¯æ¥è‡ªçŸ¥è¯†åº“æœ¬èº«ï¼ŒURL ä¸èƒ½åšä»»ä½•æ”¹åŠ¨ã€‚<br>
> è¯·ç¡®ä¿å›ç­”ç®€æ´ã€ä¸“ä¸šï¼Œå°†å›¾ç‰‡è‡ªç„¶åœ°èå…¥å›ç­”å†…å®¹ä¸­ã€‚


---

### RAGFlow UI 

å°†å¼€æºçš„ `dist` ç›®å½•å¤åˆ¶åˆ° docker å†…çš„ /ragflow/web/dist ç›®å½•ä¸‹ï¼Œè¦†ç›–åŸæœ‰çš„ dist å³å¯
```bash
docker cp -r dist {ragflow_container_name}:/ragflow/web/
```


## ç¼–è¯‘ Docker

```bash
docker buildx build --platform linux/amd64 --target backend -t zxwei/knowflow-server:v0.3.0 --push .

docker buildx build --platform linux/amd64 --target frontend -t zxwei/knowflow-web:v0.3.0 --push .

```


## TODO
- [x] æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼çš„ MinerU è§£æ
- [ ] å¢å¼º MarkDown æ–‡ä»¶çš„åˆ†å—è§„åˆ™


## äº¤æµç¾¤
å¦‚æœæœ‰å…¶å®ƒéœ€æ±‚æˆ–é—®é¢˜å»ºè®®ï¼Œå¯åŠ å…¥äº¤æµç¾¤è¿›è¡Œè®¨è®ºã€‚

å¦‚éœ€åŠ ç¾¤ï¼ŒåŠ æˆ‘å¾®ä¿¡ skycode007ï¼Œå¤‡æ³¨"åŠ ç¾¤"å³å¯ã€‚


## é¸£è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®å¼€å‘ï¼š

- [ragflow](https://github.com/infiniflow/ragflow)

- [v3-admin-vite](https://github.com/un-pany/v3-admin-vite)

- [ragflow-plus](https://github.com/zstar1003/ragflow-plus/)

## æ›´æ–°ä¿¡æ¯è·å–

ç›®å‰è¯¥é¡¹ç›®ä»åœ¨æŒç»­æ›´æ–°ä¸­ï¼Œæ›´æ–°æ—¥å¿—ä¼šåœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·[KnowFlow ä¼ä¸šçŸ¥è¯†åº“]ä¸Šå‘å¸ƒï¼Œæ¬¢è¿å…³æ³¨ã€‚



## å¸¸è§é—®é¢˜

1. å¦‚ä½•ç»™ MinerU è¿›è¡Œ GPU åŠ é€Ÿ

   1ï¼‰ å®‰è£… nvidia-container-toolkit

      ```bash
      # æ·»åŠ æº
      distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
      curl -s -L https://nvidia.github.io/libnvidia-container/gpgkey | sudo apt-key add -
      curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
        sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

      # å®‰è£…ç»„ä»¶
      sudo apt-get update
      sudo apt-get install -y nvidia-container-toolkit

      # é‡å¯ Docker
      sudo systemctl restart docker
      ```

   2ï¼‰ä¿®æ”¹ `docker-compose.yml` çš„ `backend` å®¹å™¨ä¸‹ï¼Œå¢åŠ ï¼š

      ```yaml
      backend:
        deploy:
          resources:
            reservations:
              devices:
                - driver: nvidia
                  count: all
                  capabilities: [gpu]
      ```

   3ï¼‰ä¿®æ”¹ `server/magic-pdf.json`ï¼ŒæŠŠ `device-mode` ä» `cpu` ä¸º `cuda`ï¼š

      ```json
      "device-mode": "cuda"
      ```

